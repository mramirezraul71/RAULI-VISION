# RAULI-VISION — Render Blueprint
# Espejo y Proxy: Go nativo. Build desde raíz del repo con go build -C (Go 1.20+).
# Tras el primer deploy, ESPEJO_URL del proxy debe apuntar a la URL pública del espejo.

services:
  - type: web
    name: espejo-backend
    runtime: go
    plan: starter
    buildCommand: go mod download -C espejo && go build -C espejo -ldflags="-s -w" -o espejo/espejo ./cmd/server
    startCommand: ./espejo/espejo
    buildFilter:
      paths: [espejo/**]
    envVars:
      - key: PORT
        value: "8080"
      - key: JWT_SECRET
        generateValue: true
      - key: ADMIN_TOKEN
        generateValue: true
      - key: VERSION
        value: "1.0.0"
    healthCheckPath: /api/health

  - type: web
    name: proxy-backend
    runtime: go
    plan: starter
    buildCommand: go mod download -C cliente-local && CGO_ENABLED=0 go build -C cliente-local -ldflags="-s -w" -o cliente-local/proxy ./cmd/proxy
    startCommand: ./cliente-local/proxy
    buildFilter:
      paths: [cliente-local/**]
    envVars:
      - key: PORT
        value: "3000"
      - key: ESPEJO_URL
        value: https://espejo-backend.onrender.com
        # Tras el primer deploy, si el nombre del servicio cambia, ajustar esta URL en el Dashboard de Render
      - key: CLIENT_ID
        generateValue: true
      - key: CLIENT_SECRET
        generateValue: true
      - key: VERSION
        value: "1.0.0"
    healthCheckPath: /api/health
