# RAULI-VISION — Render Blueprint
# Espejo y Proxy: rootDir obligatorio para que Go resuelva módulo e internos en monorepo.
# Rama: main (correcta). Tras el deploy, ESPEJO_URL debe apuntar a la URL del espejo.

services:
  - type: web
    name: espejo-backend
    runtime: go
    plan: starter
    branch: main
    rootDir: espejo
    buildCommand: go mod download && go build -ldflags="-s -w" -o espejo ./cmd/server
    startCommand: ./espejo
    envVars:
      - key: PORT
        value: "8080"
      - key: JWT_SECRET
        generateValue: true
      - key: ADMIN_TOKEN
        generateValue: true
      - key: VERSION
        value: "1.0.0"
    healthCheckPath: /api/health

  - type: web
    name: proxy-backend
    runtime: go
    plan: starter
    branch: main
    rootDir: cliente-local
    buildCommand: go mod download && CGO_ENABLED=0 go build -ldflags="-s -w" -o proxy ./cmd/proxy
    startCommand: ./proxy
    envVars:
      - key: PORT
        value: "3000"
      - key: ESPEJO_URL
        value: https://espejo-backend.onrender.com
        # Tras el primer deploy, si el nombre del servicio cambia, ajustar esta URL en el Dashboard de Render
      - key: CLIENT_ID
        generateValue: true
      - key: CLIENT_SECRET
        generateValue: true
      - key: VERSION
        value: "1.0.0"
    healthCheckPath: /api/health
